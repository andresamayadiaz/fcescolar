<div class="paragraphs">
	<div class="row">
		<div class="col-sm-12">
			<div class='form-group'>
				<label>Person</label>
				<%= autocomplete_field_tag 'search_person_name', @person.try(:name), autocomplete_person_name_people_path, {:class=>'form-control'} %>
			</div>
			<div class='form-group'>
				<%= link_to 'Search', 'javascript:void(0);', :id=>'search_person_by_name', :class=>'btn btn-info btn-sm' %>
			</div>
		</div>
		<% if @unassigned_roles.present? and @person.status %>
		<div class="col-sm-12">
			<br/>
			<fieldset>
				<legend>Add Role</legend>
				<%= simple_form_for(@new_user_role, {:url=>add_new_role_people_url, :html=>{:method=>'POST',:class=>'form-inline'} } )  do |f| %>
				<%= f.input :user_id, :as => :hidden %>
				<%= f.input :role_id, collection: @unassigned_roles.map { |r| [r.name.humanize, r.id] }, label:'Roles', class: 'form-control' %>
				<%= f.input :contract %>
				<%= f.input :contract_sign_date, as: :string, input_html: { class: "datepicker" }  %>
				<%= f.input :date_of_receipt, as: :string, input_html: { class: "datepicker" }  %>
				<%= button_tag( :class => "btn btn-primary btn-small") do %>
				<i class="icon-save"></i>Save
				<% end %>
				<% end %>
			</fieldset>
		</div>
		<% end %>
		<% if @person.user.roles.present? and @person.user.roles.length>0 %>
		<div class="col-sm-12">
			<br/>
			<table class='table table-bordered table-striped'>
				<thead>
					<tr>
						<th>Role</th>
						<th>Status</th>
					</tr>
				</thead>
				<tbody>
					<% @person.user.users_roles.each do |user_role| %>
					<tr>
						<td><%= user_role.role.name.humanize %></td>
						<td>
							<%= simple_form_for(user_role, {url: change_role_status_people_path}) do |f| %>
							<%= f.input :user_id, :as => :hidden %>
							<%= f.input :role_id, :as => :hidden %>
							<%= f.collection_radio_buttons :status, [[true, 'Active'] ,[false, 'Inactive']], :first, :last %>
							<% end %>
						</td>
					</tr>
					<% end %>
				</tbody>
			</table>
		</div>
		<% end %>
	</div>
</div>

<style>
	.edit_users_role span {
		margin-right:27px;
	}
</style>

<% content_for :specific_js do %>
<script type="text/javascript">
	$(document).ready(function(){
		$('.datepicker').datepicker({
	      format: "yyyy-mm-dd"
	    });
		$('.edit_users_role').submit(function(e){
			e.preventDefault(); //STOP default action
			var _this = $(this);
			var postData = _this.serializeArray();
      		var formURL = _this.attr("action");
			$.ajax(
			{
				url : formURL,
				type: "POST",
				data : postData,
				success:function(data){
					alert('Role status is updated')
				},
				error: function(data){
					alert('Failed to update role status')
				}
			});
		});

		$(".edit_users_role").each(function(){
			$(this).find("[type=radio]").change(function(){
				$(this).parents("form").submit();
			})
		})

		$('#search_person_name').bind('railsAutocomplete.select', function(event, data){
		  $('#search_person_by_name').attr('href','/people/assign_roles?id='+data.item.id)
		});
	});
</script>
<% end %>
<style type="text/css">
	.ui-autocomplete {
		position: absolute;
		top: 100%;
		left: 0;
		z-index: 1000;
		float: left;
		display: none;
		min-width: 160px;   
		padding: 4px 0;
		margin: 0 0 10px 25px;
		list-style: none;
		background-color: #ffffff;
		border-color: #ccc;
		border-color: rgba(0, 0, 0, 0.2);
		border-style: solid;
		border-width: 1px;
		-webkit-border-radius: 5px;
		-moz-border-radius: 5px;
		border-radius: 5px;
		-webkit-box-shadow: 0 5px 10px rgba(0, 0, 0, 0.2);
		-moz-box-shadow: 0 5px 10px rgba(0, 0, 0, 0.2);
		box-shadow: 0 5px 10px rgba(0, 0, 0, 0.2);
		-webkit-background-clip: padding-box;
		-moz-background-clip: padding;
		background-clip: padding-box;
		*border-right-width: 2px;
		*border-bottom-width: 2px;
		cursor:pointer;
	}

	.ui-menu-item > a.ui-corner-all {
		display: block;
		padding: 3px 15px;
		clear: both;
		font-weight: normal;
		line-height: 18px;
		color: #555555;
		white-space: nowrap;
		text-decoration: none;
		cursor:pointer;
	}

	.ui-state-hover, .ui-state-active {
		color: #ffffff;
		text-decoration: none;
		background-color: #0088cc;
		border-radius: 0px;
		-webkit-border-radius: 0px;
		-moz-border-radius: 0px;
		background-image: none;
		cursor: pointer;
	}
</style>