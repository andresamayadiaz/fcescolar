<style>
  #start_period_wrap, #start_period_month, #weekday_wrap, #latest_added_students {display: none;}
</style>
<div class='row'>
  <div class='col-sm-2'>Study Plan:</div>
  <div class='col-sm-4'>
    <%= collection_select(:study_plan, :id, @available_study_plans, :id, :name, {prompt: 'Available Study Plans'}, {class: 'form-control'}) %>
  </div>
</div>
<hr class='normal'/>
<div class='row' id='start_period_wrap'>
  <div class='col-sm-2'>Choose Start Period:</div>
  <div class='col-sm-2'>
    <select id='start_period_year' class='form-control'></select>
  </div>
  <div class='col-sm-2'>
    <select id='start_period_month' class='form-control'></select>
  </div>
</div>
<hr class='normal'/>
<div class='row' id='weekday_wrap'>
  <div class='col-sm-2'>Week Day:</div>
  <div class='col-sm-4'>
    <select id='weekday' class='form-control'></select>
  </div>
</div>
<hr class='normal'/>
<div class='row' id='latest_added_students'>
  <div class='col-sm-7'>
    <table class='table-striped' width='100%'>
      <thead>
        <tr>
          <th>Matricula</th>
          <th>Apellido Paterno</th>
          <th>Apellido Materno</th>
          <th>Nombre</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>
</div>
<% content_for :specific_js do %>
<script type='text/javascript'>
  $(document).ready(function(){
    $('#study_plan_id').change(function(){
      var url = '/groups/get_years_of_selected_study_plan?study_plan_id='+$(this).val();
      $.ajax({
        url: url,
        success: function(data){
          var html_element = '<option>Select Years</option>';
          if(data){
            $.each(data,function(i,v){
              html_element += '<option value="'+v+'">'+v+'</option>';
            })
            $('#start_period_year').html(html_element);
            $('#start_period_wrap').slideDown(); 
          }
        }
      })
    })
    $('#start_period_year').change(function(){
      var url = '/groups/get_months_of_selected_year?year='+$(this).val();
      $.ajax({
        url: url,
        success: function(data){
          var html_element = '<option>Select Months</option>';
          if(data){
            $.each(data,function(i,v){
              html_element += '<option value="'+v.id+'">'+v.month+'</option>';
            })
            $('#start_period_month').html(html_element);
            $('#start_period_month').slideDown(); 
          }
        }
      })
    })
    $('#start_period_month').change(function(){
      var url = '/groups/get_week_day_of_selected_month?study_plan_id='+$('#study_plan_id').val()+'&year='+$('#start_period_year').val()+'&month='+$(this).find(':selected').text();
      $.ajax({
        url: url,
        success: function(data){
          var html_element = '<option>Select Week Day</option>';
          if(data){
            $.each(data,function(i,v){
              html_element += '<option value="'+v.id+'">'+v.weekday+'</option>';
            })
            $('#weekday').html(html_element);
            $('#weekday_wrap').slideDown(); 
          }
        }
      })
    })
    $('#weekday').change(function(){
      var url = '/groups/load_latest_added_students';
      $.ajax({
        url: url,
        success: function(data){
          var html_element = '';
          if(data){
            $.each(data,function(i,v){
              html_element += '<tr><td><input type="checkbox" name="selected_student" value="'+v.id+'"/>&nbsp;'+v.id+'</td><td>'+v.fathers_maiden_name+'</td><td>'+v.mothers_maiden_name+'</td><td>'+v.first_name+'</td></tr>';
            })
            $('#latest_added_students tbody').html(html_element);
            $('#latest_added_students').slideDown(); 
          }
        }
      })
    })
  })  
</script>
<% end %>
